
<html >
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
  <title></title>

  <link href="lib/ionic/css/ionic.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
<link href="https://code.ionicframework.com/1.0.0-beta.9/css/ionic.min.css" rel="stylesheet">
  <script src="https://code.ionicframework.com/1.0.0-beta.9/js/ionic.bundle.min.js"></script>
  <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
  <link href="css/ionic.app.css" rel="stylesheet">
-->

<!--For users deploying their apps to Windows 8.1 or Android Gingerbread, platformOverrided.js
will inject platform-specific code from the /merges folder -->
<script src="js/platformOverrides.js"></script>

<!-- ionic/angularjs js -->
<script src="lib/ionic/js/ionic.bundle.js"></script>

<!-- cordova script (this will be a 404 during development) -->
<script src="cordova.js"></script>

<!-- your app's js -->
<script src="js/app.js"></script>
</head>
<body ng-app="starter">

  <div ng-controller="AppController">
    <ion-nav-view></ion-nav-view>
  </div>
<!--Menu de coté -->
  <script id="app-abstract.html" type="text/ng-template">
    <ion-side-menus>
      <ion-side-menu-content>
        <ion-nav-bar class="bar-positive">
          <ion-nav-back-button class="button-icon ion-arrow-left-c">
          </ion-nav-back-button>
        </ion-nav-bar>
        <ion-nav-buttons side="right">
          <button class="button button-icon button-clear ion-navicon" ng-click="toggleRight()"></button>
        </ion-nav-buttons>
        <ion-nav-view name="appContent" animation="slide-left-right"></ion-nav-view>
      </ion-side-menu-content>
      <ion-side-menu side="right">
        <ion-header-bar class="bar-balanced">
          <h1 class="title">Menu</h1>
        </ion-header-bar>
        <ion-content>
          <!--<div id="navigationdata" name="{{user.usager.technicalId}}" style="visibility: hidden" ></div>-->
          <ul class="list">
            <li>
              <a class="item" ui-sref="app.pjva" ng-click="toggleRight()">
                PuisJeVousAider
              </a>
            </li>
            <li>
              <a class="item" href="" ng-click="toggleRight()">
                Agenda
              </a>
            </li>
            <li>
              <a class="item" href="" ng-click="toggleRight()">
                Album
              </a>
            </li>
          <li>
            <a class="item" href="" ng-click="toggleRight()">
              Suivi Medical
            </a>
          </li>
          <li>
            <a class="item" href="" ng-click="toggleRight()">
              Messagerie
            </a>
          </li>
          <li>
            <a class="item" href="" ng-click="toggleRight()">
              Cagnotte
            </a>
          </li>
            <li>
              <a class="item" href="" ng-click="toggleRight()">
                Cercle
              </a>
            </li>
            <li>
              <a class="item" href="" ng-click="toggleRight()">
                Equipement
              </a>
            </li>
          </ul>
        </ion-content>
      </ion-side-menu>
    </ion-side-menus>
  </script>

<!--Accueil-->
  <script id="home.html" type="text/ng-template">
    <ion-view title="Accueil">
      <ion-nav-buttons side="right">
        <button menu-toggle="right" class="button button-icon icon ion-navicon"></button>
      </ion-nav-buttons>
      <ion-content has-header="true" has-footer="true" padding="true">
        <!-- Bouton de Popup d'urgence-->
        <button ng-controller="UrgenceActivation" class="button button-block button-assertive" ng-click="ShowUrgence()"><h3 style="color: white">Urgence</h3>
        </button>

        <h3>Dernières activités:</h3>
        <!--Liste de cartes des dernières activités de l'usager-->
        <div name="journal"class="list card">
          <a ui-sref="app.activity" class="item item-icon-left">
            <i class="icon ion-ios-medical"></i>
            Rapport du Docteur Who du 09/01/2017
          </a>
          <a ui-sref="app.activity" class="item item-icon-left">
            <i class="icon ion-ios-cart"></i>
            Courses faites par Monsieur Someone le 08/01/2017
          </a>
          <a ui-sref="app.activity" class="item item-icon-left">
            <i class="icon ion-ios-people"></i>
            Famille Michu est passée le 05/01/2017
            <img src=""  alt=""></img>
          </a>
        </div>

      </ion-content>
      <!--Bouton de nouvelle entrée dans le journal de l'usager, à tester si la barre reste bien en bas sur un vrai portable-->
      <ion-footer-bar class="bar-balanced" align-title="center" >
        <h1 class="title"> <a ui-sref="app.activityform"  style="text-align: center">Nouvelle Entrée</a></h1>
      </ion-footer-bar>
    </ion-view>
  </script>

<!-- Lecture d'un rapport -->
<script id="activity.html" type="text/ng-template">
    <ion-view title="Entrée du journal">
      <ion-nav-buttons side="right">
        <button menu-toggle="right" class="button button-icon icon ion-navicon"></button>
      </ion-nav-buttons>
      <ion-content>
        <div class="list">
        <label class="item  item-stacked-label">
          <h3 >Titre du rapport + date</h3>
          </label>
          <br />
          <label class="item item-input item-stacked-label">
            <span class="input-label">Rapport</span>
            <textarea style="background-color: lightgray" placeholder="yyy" rows="8" cols="10">
            </textarea>
          </label>
          <!--Text to Speech ici-->
          <button class="button button-block button-calm"> Lire le texte</button>

              </div>
      </ion-content>
  </ion-view>
</script>

<!-- Formulaire d'entrée dans le journal-->
  <script id="activityform.html" type="text/ng-template" >
    <ion-view title="Ajout d'entrée au journal">
      <ion-nav-buttons side="right">
        <button menu-toggle="right" class="button button-icon icon ion-navicon"></button>
      </ion-nav-buttons>
      <ion-content>
        <form ng-submit="" method="post">
          <div class="list">
            <label class="item item-input item-stacked-label">
              <span class="input-label">Titre</span>
              <input type="text" placeholder="" ng-model="">
            </label>

            <label class="item item-input item-select">
              <div class="input-label">
                Type de rapport <!--Change l'icone de la card-->
              </div>
              <select>
                <option selected>Famille</option>
                <option >Medecin</option>
                <option>Tiers de confiance</option>
              </select>
            </label>
          </div>
          <label class="item item-input">
            <span class="input-label">Date</span>
            <input type="date">
          </label>

          <!--Speech to text à ajouter ici-->
          <label class="item item-input item-stacked-label">
            <span class="input-label">Rapport</span>
            <textarea style="background-color: lightgray" placeholder="yyy" rows="8" cols="10">
            </textarea>
          </label>
          <div class="submit">
            <button class="button button-block button-positive">Envoyer</button>
          </div>
        </form>
      </ion-content>
    </script>

<!--Page PuisJeVousAider-->
    <script id="pjva.html" type="text/ng-template">
      <ion-view title="PuisJeVousAider">
        <ion-nav-buttons side="right">
          <button menu-toggle="right" class="button button-icon icon ion-navicon"></button>
        </ion-nav-buttons>
        <ion-content has-header="true" padding="true" ng-controller="PJVAActivation">
          <ion-toggle ng-model="pjvavalue.checked"  ng-change="AlertChanged('listeOrganismes')" toggle-class="toggle-calm">Activer PuisJeVousAider?</ion-toggle>
          <br />
          Carte PuisJeVousAider:

          <div class="list" id="listeOrganismes" style="visibility: hidden" ng-repeat="organisme in res.organismes">
            <a id="{{organisme.raisonSociale}}" ng-click="ShowDemande('{{organisme.raisonSociale}}')" class="item item-icon-left item-royal">
              <i  class="icon ion-social-usd-outline"></i>
              Organisme: {{organisme.raisonSociale}}<br />
              type: {{organisme.typeorganisme}}
            </a>
            <br />
          </div>

        </ion-content>

      </ion-view>
 
    </script>


  </body>

  <script>
    window.localStorage.setItem("User", "");

angular.module('starter', ['ionic'])

//Navigation dans l'application
.config( function($stateProvider,$urlRouterProvider){

  $stateProvider

  //Page de connexion
  .state('connexion', {
    url: "/connexion",
    templateUrl: "connexion.html",
    controller: "ConnexionPageController"
  })
//Abstraite, utile pour le menu de coté et la séparation connexion/application
  .state('app', {
    url: "/app",
    abstract: true,
    templateUrl: "app-abstract.html",
    controller: "AppController"
  })

  //Page d'accueil
  .state('app.home', {
    url: "/home",
    views: {
      'appContent': {
        templateUrl: "home.html",
        controller: "HomeCtrl"
      }
    }
  })

  //Page PuisJeVousAider
  .state('app.pjva', {
    url: "/pjva",
    views: {
      'appContent': {
        templateUrl: "pjva.html",
        controller: "PJVACtrl"
      }
    }
  })

  //Page De formulaire d'entrée dans le journal de l'usager
  .state('app.activityform', {
    url: "/activityform",
    views: {
      'appContent': {
        templateUrl: "activityform.html",

      }
    }
  })

  //Page de lecture d'un rapport
  .state('app.activity', {
    url: "/activity",
    views: {
      'appContent': {
        templateUrl: "activity.html",

      }
    }
  })
//Par défaut, redirection sur la page de connexion
  $urlRouterProvider.otherwise('/app/home')
})

//Controleur initié au chargement de la page de connexion
.controller('ConnexionPageController', function ($scope, $ionicSideMenuDelegate) {

})

//Controleur initié au chargement du "menu de coté" (la navigation abstraite "app")
.controller('AppController', function ($scope, $ionicSideMenuDelegate, $stateParams, $http) {

//idée à approfondir
  //userGetUrl= "http://localhost:9050/usagers/login/" + $stateParams.login;
  //  alert($stateParams.login)
  //$http.get(userGetUrl).success(function (response) {
    //  alert('re')
    //  $scope.user = response;
    //  alert(response)
  //})


  //Permet l'apparition du menu de coté
  $scope.toggleRight = function () {
  $ionicSideMenuDelegate.toggleRight();
  };
})

//Controleur initié au chargement de la page d'accueil
.controller('HomeCtrl', function ($scope, $ionicLoading, $state, $stateParams, $http,$ionicSideMenuDelegate) {

  })
//Controleur initié au chargement de la page de PuisJeVousAider
.controller('PJVACtrl', function ($scope, $ionicLoading, $state, $stateParams, $http, $ionicSideMenuDelegate) {
//Va chercher les organismes enregistrés via l'api organisme
  gurl = "http://localhost:9049/organismes/all"
 
  $http.get(gurl).success(function (response) {
     
      $scope.res = response;
  })
})

//Controleur initié au sein de la page PuisJeVousAider
.controller('PJVAActivation', function ($scope, $ionicLoading, $state, $ionicPopup, $http, $ionicSideMenuDelegate) {
//fait apparaitre ou non les cartes d'organismes en fonction de l'activation de PuisJeVousAider
    $scope.AlertChanged = function (id) {

    if(document.getElementById(id).style.visibility=="hidden"){
    document.getElementById(id).style.visibility="visible";

    }else {
    document.getElementById(id).style.visibility="hidden";
    }
    }
//fait apparaitre un popup au clic sur une carte d'organisme
    $scope.ShowDemande = function (id) {

      var DemandeOrganismePopup= $ionicPopup.confirm({
        title: 'Demande &agrave; '+ id ,
        template: 'Confirmer l\'envoi?',
        cancelText: "Annuler",
        okText: 'Confirmer'
      });

      DemandeOrganismePopup.then(function(res) {
        //si ok press�
        if(res){

        }
        //si annuler press�
        else{

        }
      })
    }
})

//Controleur initié au clic du bouton urgence
.controller('UrgenceActivation', function ($scope, $ionicLoading,  $ionicPopup, $state, $http, $ionicSideMenuDelegate) {
//fait apparaitre un popup d'urgence
  $scope.ShowUrgence = function () {

    var UrgencePopup = $ionicPopup.confirm({
      cssClass: 'urgence',
      title: 'Appel d\'urgence activ&eacute;',
      template: 'Nous faisons notre possible pour faire venir de l\'aide',
      cancelText: "Annuler",
      okText: 'J\'ai re&ccedil;u de l\'aide',
      okType: 'button-balanced'
    });

    UrgencePopup.then(function(res) {
      //si ok press�
      if(res){

      }
      //si annuler press�
      else{

      }
    });
  };
})
//Controleur initié au clic sur le bouton de connexion
.controller('connexionCtrl', function ($scope, $ionicLoading, $state, $http, $ionicSideMenuDelegate) {
//envoie la requete de connexion à l'api assistance
  $scope.search = function (login,mdp) {

    var json = JSON.stringify({
      "login": login,
      "mdp":mdp
    });

    var url = "http://localhost:9100/connect"
    $http({
      method: 'POST',
      url: url,
      data: json,
      headers: { "Content-Type": 'application/json' },
      timeout: 10000
      // success response
    }).success(function (data, status, headers, config) {
        //SUCESSS
        alert('erreur1')
//retourne  l'usager en json et ses informations
        url = "http://localhost:9050/usagers/login/" + login;
        //alert(url)
        $http.get(url).success(function (response) {



          //  alert('user presque enregistré')
          //  alert (url)
        })

        $state.go('app.home' )

    }).error(function (data, status, headers, config) {
      alert("didn't pass");

      alert(status)



    })
    ;

  }

})


  </script>



  </html>
